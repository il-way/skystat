# ===============================================================
# 1. COMMON & DEFAULT (기본 설정 + 로컬 개발용)
# ===============================================================
spring:
  # 기본 어플리케이션 이름 (없으면 skystat-api)
  application:
    name: ${APP_NAME:skystat-api}

  datasource:
    # Docker Compose에서 HOST, PORT만 바꿔 끼우면 되도록 변경
    url: jdbc:mysql://${MYSQL_HOST:localhost}:${MYSQL_PORT:3306}/${MYSQL_DATABASE:skystat_stage}?useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=UTC
    username: ${DB_USER:root}
    password: ${DB_PASSWORD}
    driver-class-name: com.mysql.cj.jdbc.Driver

  servlet:
    multipart:
      maxFileSize: 30MB
      maxRequestSize: 30MB

  jpa:
    database-platform: org.hibernate.dialect.MySQLDialect
    hibernate:
      ddl-auto: none # 기본적으로 자동 변경 끔 (안전)
    properties:
      hibernate:
        default_batch_fetch_size: 1000
        jdbc.batch_size: 100
        order_inserts: true
        format_sql: true
    show-sql: false # 기본적으로 SQL 숨김

  aop:
    proxy-target-class: true

server:
  forward-headers-strategy: native
  tomcat:
    basedir: ./logs/tomcat
    remoteip:
      remote-ip-header: x-forwarded-for
      protocol-header: x-forwarded-proto
      internal-proxies: '127\.0\.0\.1|10\.\d{1,3}\.\d{1,3}\.\d{1,3}|192\.168\.\d{1,3}\.\d{1,3}|172\.(1[6-9]|2\d|3[0-1])\.\d{1,3}\.\d{1,3}'
    accesslog:
      enabled: true
      directory: ../access
      prefix: access
      suffix: .log
      file-date-format: .yyyy-MM-dd
      pattern: 'corr=%{X-Correlation-Id}o ip=%a xff="%{X-Forwarded-For}i" t=%t method=%m uri="%U%q" status=%s bytes=%b dur_us=%D referer="%{Referer}i" ua="%{User-Agent}i"'


log:
  app:
    logger: com.ilway.skystat

  correlation:
    enabled: true
    id-length: 16
    header-name: X-Correlation-Id
    mdc-key: corrId
    request-attr: corrId

  slow:
    enabled: true
    threshold-ms: 3000

  security:
    enabled: true
    username-attr: username
    role-attr: role

  audit:
    enabled: true
    username-attr: username
    role-attr: role

logging:
  file:
    path: ./logs
  level:
    root: INFO

jwt:
  auth:
    enabled: false
---
# ===============================================================
# 2. STAGING Profile (스테이징 환경 차이점)
# ===============================================================
spring:
  config:
    activate:
      on-profile: staging

logging:
  level:
    org.hibernate.SQL: INFO

---
# ===============================================================
# 3. PRODUCTION Profile (운영 환경 차이점)
# ===============================================================
spring:
  config:
    activate:
      on-profile: prod  # 혹은 prod
  jpa:
    show-sql: false

logging:
  level:
    org.hibernate: WARN      # 하이버네이트 로그 최소화

jwt:
  secret: ${JWT_SECRET}
  auth:
    enabled: true
    include:
      - /api/admin/**
    exclude:
      - /api/public/**
      - /health
      - /actuator/**
    sources: [BEARER, COOKIE]
    cookie-name: access_token